<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CH341 test webusb</title>
</head>


<body>
  <button id="connect">Connect</button>
  <button id="disconnect">disConnect</button>
  <label for="editor">TX</label><textarea id="editor">Flash Easy</textarea>
  <button id="submit">Send</button>
  <label for="output">RX</label><textarea id="output"></textarea>
</body>
<script src="CH341.js"></script>
<script src="UART.js"></script>
<script src="I2C.js"></script>
<script src="PCA9685.js"></script>
<script>
  const serial = new UART()
  const i2c = new I2C()
  document.querySelector("#connect").onclick = async () => {
    const device = await CH341.requestDevice()
    await i2c.open(device)
    /* await serial.initSerial(9600)
     await serial.startRx(data => console.log(String.fromCharCode(...data)))*/
    let foud_count = 0;
    for (let i = I2C.I2C_AddressMin; i <= I2C.I2C_AddressMax; ++i) {
      if (await i2c.I2CDetect(i)) {
        ++foud_count;
        console.log(`Found i2c slave device at address 0x${i.toString(16)}`);
      }
    }
    /*const addr = 0x40
    i2c.setAddr(addr)
    const pca = new PCA9685(i2c)
    await pca.setPWMFreq(1000);
    for (let i = 20; i < 40; i += 5) {
      //await pca.setServoAngle(0, i);
      await pca.analog_write(0, i)
      await CH341.wait(30);
    }*/
    console.log(`Scan complete, ${foud_count} found.`);
  }

  document.querySelector("#disconnect").onclick = async () => {
    await serial.stop()
  }

  document.querySelector("#submit").onclick = async () => {
    await serial.startTx("TEST")
  }
</script>

</html>